<!doctype html>

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2.0.5 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Tue, 26 Jan 2016 23:51:12 +0000">

<link rel="stylesheet" type="text/css" href="../stylesheet.css">
<link rel="start" href="../overview-summary.html">

<title>_controllers\module.php (SWEDTeamTitle)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>RObo cosi header</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../overview-files.html">Files</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../todo-list.html">Todo</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../source\_controllers\module.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>_controllers\module.php</h1>
<hr>

<a name="line1"></a><pre><?php
<a name="line2"></a>/**
<a name="line3"></a> * Abstraktná trieda pre moduly,
<a name="line4"></a> * ktorá definuje základnú povinnú funkčnosť pre všetky typy modulov.
<a name="line5"></a> * @abstract
<a name="line6"></a> */
<a name="line7"></a>if(file_exists('../_views/Module_v.php'))
<a name="line8"></a>    require_once('../_views/Module_v.php');
<a name="line9"></a>if(file_exists('_views/Module_v.php'))
<a name="line10"></a>    require_once('_views/Module_v.php');
<a name="line11"></a>
<a name="line12"></a>
<a name="line13"></a>abstract class Module{
<a name="line14"></a>  /**
<a name="line15"></a>   * pole informácií o zakládných vlastnostiach modulu
<a name="line16"></a>   *  @var  array
<a name="line17"></a>   */
<a name="line18"></a>  public $containerData = array();
<a name="line19"></a>  /**
<a name="line20"></a>   * pole informácií o obsahu modulu
<a name="line21"></a>   * @var array
<a name="line22"></a>   */
<a name="line23"></a>  public $contentData   = array();
<a name="line24"></a>  /**
<a name="line25"></a>   * pole informácií o priložených súboroch modulu 
<a name="line26"></a>   * @var array
<a name="line27"></a>   */
<a name="line28"></a>  public $file;
<a name="line29"></a>  /**
<a name="line30"></a>   * pole child modulov modulu( gallery > image )
<a name="line31"></a>   * @var File
<a name="line32"></a>   */
<a name="line33"></a>  public $childsData    = array();
<a name="line34"></a>  /**
<a name="line35"></a>   * používateľ ktorý vytvoril modul
<a name="line36"></a>   * @var User
<a name="line37"></a>   */
<a name="line38"></a>  public $created_by;
<a name="line39"></a>  /**
<a name="line40"></a>   * používateľ ktorý editoval modul
<a name="line41"></a>   * @var User
<a name="line42"></a>   */
<a name="line43"></a>  public $edited_by;
<a name="line44"></a>  /**
<a name="line45"></a>   * aktuálne prihlásený používateľ
<a name="line46"></a>   * @var User
<a name="line47"></a>   */
<a name="line48"></a>  public $loggedUser;
<a name="line49"></a>  /**
<a name="line50"></a>   * typ modulu
<a name="line51"></a>   * @var string
<a name="line52"></a>   */
<a name="line53"></a>  public $module_type;
<a name="line54"></a>
<a name="line55"></a>
<a name="line56"></a>
<a name="line57"></a>  /**
<a name="line58"></a>   * Konštruktor abstraktnej triedy Module
<a name="line59"></a>   * @param [type] $id [description]
<a name="line60"></a>   * @abstract
<a name="line61"></a>   */
<a name="line62"></a>  abstract function __construct($id);
<a name="line63"></a>  /**
<a name="line64"></a>   * Nastavenie Modulu podľa zadaného ID
<a name="line65"></a>   * @param integer $id ID modulu
<a name="line66"></a>   */
<a name="line67"></a>  abstract public function setById($id);
<a name="line68"></a>    /**
<a name="line69"></a>   * Funkcia vráti názov typu modulu
<a name="line70"></a>   * @return string 
<a name="line71"></a>   * @abstract
<a name="line72"></a>   */
<a name="line73"></a>  abstract static public function getModuleTypeName();
<a name="line74"></a>  /**
<a name="line75"></a>   * Funkcia vráti view pre modul na stránke
<a name="line76"></a>   * @return string html kód pre modul
<a name="line77"></a>   * @abstract
<a name="line78"></a>   */
<a name="line79"></a>  abstract public function module($editable);
<a name="line80"></a>  /**
<a name="line81"></a>   * Funkcia vráti view pre editor modulu
<a name="line82"></a>   * @param  String $operation Operácia ktorá sa má vykonať po odoslaní formulára (Editovanie/Vloženie)
<a name="line83"></a>   * @return string html kód editora modulu
<a name="line84"></a>   * @abstract
<a name="line85"></a>   */
<a name="line86"></a>  abstract public function editor($operation);
<a name="line87"></a>
<a name="line88"></a>/**
<a name="line89"></a> * Funkcia nacita data z post premennych ktore sa odoslu po submitnuti fomulara
<a name="line90"></a> * @return [type] [description]
<a name="line91"></a> */
<a name="line92"></a>  abstract public function getFormData();
<a name="line93"></a>  
<a name="line94"></a>  /**
<a name="line95"></a>   * Funkcia vloží modul do DB
<a name="line96"></a>   * @return boolean true ak vloží úspešne / false ak nastane chyba
<a name="line97"></a>   * @abstract
<a name="line98"></a>   */
<a name="line99"></a>  abstract public function insert();
<a name="line100"></a>  /**
<a name="line101"></a>   * Funkcia zmení informácie o module v DB
<a name="line102"></a>   * @return boolean true ak zmení úspešne / false ak nastane chyba
<a name="line103"></a>   * @abstract
<a name="line104"></a>   */
<a name="line105"></a>  abstract public function update();
<a name="line106"></a>  /**
<a name="line107"></a>   * Funkcia zmaže modul z DB
<a name="line108"></a>   * @return boolean true ak zmaže úspešne / false ak nastane chyba
<a name="line109"></a>   * @abstract
<a name="line110"></a>   */
<a name="line111"></a>  abstract public function delete();
<a name="line112"></a>
<a name="line113"></a>
<a name="line114"></a>    /**
<a name="line115"></a>     * Funkcia uloží validné premenné odoslané z formulára a uloží ich do vnútornej štruktúry objektu
<a name="line116"></a>     * Overuje prihlasenie pouzivatela, administratorske prava pouzivatela, spravnost id pre modul a page,
<a name="line117"></a>     * rozmery sirku a vysku modulu, status
<a name="line118"></a>     * @return boolean true ak sú dáta posielané z formulára validné / inak false
<a name="line119"></a>     */
<a name="line120"></a>    public function verify(){
<a name="line121"></a>
<a name="line122"></a>        $success = true;
<a name="line123"></a>
<a name="line124"></a>        // ----------- Overenie uzivatelskych práv ----------------START
<a name="line125"></a>        // Overenie ci je uzivatel prihlaseny
<a name="line126"></a>        if(!$this->loggedUser->getUserID()!=0){
<a name="line127"></a>            $this->printAlert("danger", "Permission Error:", "You must be logged in");
<a name="line128"></a>            return false;
<a name="line129"></a>        }
<a name="line130"></a>        // Overenie ci ma uzivatel pravo editovat alebo vkladat nove moduly
<a name="line131"></a>        if(!$this->loggedUser->isAdmin()){
<a name="line132"></a>            $this->printAlert("danger", "Permission Error:", "You don\'t have prermission to insert or edit this module.");
<a name="line133"></a>            return false;
<a name="line134"></a>        }
<a name="line135"></a>
<a name="line136"></a>        // ----------- Overenie uzivatelskych práv ----------------END
<a name="line137"></a>        
<a name="line138"></a>        // ----------- Pridanie noveho modulu na stranku -------- START
<a name="line139"></a>
<a name="line140"></a>        if(isset($_GET['insert'])){
<a name="line141"></a>        
<a name="line142"></a>            //  Overenie ci je nastavene v url page_id na 
<a name="line143"></a>            //TODO: Vyrobit funkciu na overenie ci page_id patri do zoznamu nasich existujucich stranok
<a name="line144"></a>            if(!(isset($_GET['page_id']) && $_GET['page_id'] > 0)){
<a name="line145"></a>                $this->printAlert("danger", "Page Error:", "Wrong page.");
<a name="line146"></a>                return false;
<a name="line147"></a>            }
<a name="line148"></a>
<a name="line149"></a>           // nastavenie container dat
<a name="line150"></a>            $this->containerData["page_id"] = $_GET['page_id'];                     // Priradi modulu page_id stranky na ktorej sa bude zobrazovat 
<a name="line151"></a>            $this->containerData["created_by"] = $this->loggedUser->getUserID();    // Nastavi modulu created_by id uzivatela ktorý ho vytvoril
<a name="line152"></a>            $this->containerData["edited_by"] = $this->loggedUser->getUserID();     // nastavi modulu edited_by id uzivatela ktory ho upravil
<a name="line153"></a>
<a name="line154"></a>        }
<a name="line155"></a>        // ----------- Pridanie noveho modulu na stranku --------------- END
<a name="line156"></a>
<a name="line157"></a>        // ----------- Editacia existujuceho modulu na stranke -------- START
<a name="line158"></a>        if(isset($_GET['edit'])){
<a name="line159"></a>
<a name="line160"></a>            // overenie ci je zadane id modulu ktory sa ma editovat 
<a name="line161"></a>            //TODO: Vytvorit funkciu na overenie ci dane id modulu evidujeme v nasej databaze
<a name="line162"></a>            if(!(isset($_GET['id']) && $_GET['id'] > 0) ){
<a name="line163"></a>                $this->printAlert("danger", "Module Error:", "You cannot update this module (wrong module_id)");
<a name="line164"></a>                return false;
<a name="line165"></a>            }
<a name="line166"></a>            
<a name="line167"></a>            $this->containerData["edited"] = date("Y-m-d H:i:s", time());       // Nastavenie casu kedy bol modul upravovany 
<a name="line168"></a>            $this->containerData["edited_by"] = $this->loggedUser->getUserID(); // Nastavi modulu edited_by id uzivatela ktory upravoval modul
<a name="line169"></a>            $this->containerData["id"] = $_GET['id'];                           // Nastavi modulu jeho id z url
<a name="line170"></a>
<a name="line171"></a>        }
<a name="line172"></a>        // ----------- Editacia existujuceho modulu na stranke -------- END
<a name="line173"></a>        
<a name="line174"></a>        // ----------- Overenie spravneho zadania rozmerov a statusu-------- START
<a name="line175"></a>
<a name="line176"></a>        // Spravne zadanie poctu riadkov
<a name="line177"></a>        if(!(isset($_POST['rows']) && $_POST['rows']>=0 && $_POST['rows']<=4)){
<a name="line178"></a>            $this->printAlert("danger", "Rows Error:", "Number of module rows must be greater than 0 - 4");
<a name="line179"></a>            $success = false;
<a name="line180"></a>        }
<a name="line181"></a>        
<a name="line182"></a>        // Spravne zadanie poctu stlpcov
<a name="line183"></a>        if(!(isset($_POST['cols']) && $_POST['cols']>=1 && $_POST['cols']<=4)){
<a name="line184"></a>            $this->printAlert("danger", "Columns Error:", "Number of module columns must be between 1 - 4");
<a name="line185"></a>            $success = false;   
<a name="line186"></a>        }
<a name="line187"></a>        // Spravne zadanie orderu
<a name="line188"></a>        if(!(isset($_POST['order']) && $_POST['order']>=0)){
<a name="line189"></a>            $this->printAlert("danger", "Order Error:", "Wrong order value selected.");
<a name="line190"></a>            $success = false;   
<a name="line191"></a>        }
<a name="line192"></a>      
<a name="line193"></a>        // Spravneho zadanie statusu
<a name="line194"></a>        if(!(isset($_POST['status']) && $_POST['status']>=0 && $_POST['status']<=1)) {
<a name="line195"></a>            //  Ak je chybne uvedena hodnota statusu vyhodi chybu
<a name="line196"></a>            $this->printAlert("danger", "Status Error:", "Module status is not correct.");
<a name="line197"></a>            $success = false;
<a name="line198"></a>
<a name="line199"></a>        }else if($_POST['status']==0){
<a name="line200"></a>            // Ak je status nastaveny ako skryty tak vyhodi warning
<a name="line201"></a>            $this->printAlert("warning", "Status Warning:", "Module is hidden.");
<a name="line202"></a>        }
<a name="line203"></a>
<a name="line204"></a>        $this->containerData["rows"] = $_POST['rows'];      // Nastavi modulu velkost - vysku
<a name="line205"></a>        $this->containerData["cols"] = $_POST['cols'];      // Nastavi modulu velkost - sirka
<a name="line206"></a>        $this->containerData["status"] = $_POST['status'];  // Nastavi modulu status - visibility
<a name="line207"></a>        $module_id = (isset($this->containerData["id"]))? $this->containerData["id"] : 0; 
<a name="line208"></a>        $this->containerData["order"] = $this->getNewOrderValue($this->containerData["page_id"], $_POST['order'],$module_id);
<a name="line209"></a>
<a name="line210"></a>
<a name="line211"></a>       // ----------- Overenie spravneho zadania rozmerov a statusu-------- END
<a name="line212"></a>    
<a name="line213"></a>     return $success;
<a name="line214"></a>    }
<a name="line215"></a>  /**
<a name="line216"></a>   * Funkcia vygeneruje zoznam moznosti pre select  
<a name="line217"></a>   * @param  [type] $m_id [description]
<a name="line218"></a>   * @return [type]       [description]
<a name="line219"></a>   */
<a name="line220"></a>  public function getOrderOptions($m_id){
<a name="line221"></a>        //nacitanie order moznosti
<a name="line222"></a>        $order_options="";
<a name="line223"></a>        $modules = Module_m::getPageModules($this->containerData['page_id']);
<a name="line224"></a>        for ($i=0; $i < sizeof($modules)-1 ; $i++) { 
<a name="line225"></a>            if($m_id == $modules[$i]["id"])
<a name="line226"></a>                $order_options = $order_options. '<option selected value="'.($i+1).'">'.($i+1).' (actual)</option>';
<a name="line227"></a>            
<a name="line228"></a>            else
<a name="line229"></a>                $order_options = $order_options. '<option value="'.($i+1).'">'.($i+1).'</option>';
<a name="line230"></a>            
<a name="line231"></a>        }
<a name="line232"></a>        if(sizeof($modules) == 0 || $m_id==$modules[sizeof($modules)-1]["id"]) $order_options = $order_options. '<option selected value="0">Last(actual)</option>';
<a name="line233"></a>        else if($m_id > 0) $order_options = $order_options. '<option value="0">Last</option>';
<a name="line234"></a>        else $order_options = $order_options. '<option value="0" selected>Last</option>';
<a name="line235"></a>        return $order_options;
<a name="line236"></a>  }  
<a name="line237"></a>  /**
<a name="line238"></a>   * Funkcia vygeneruje a vráti novú order hodnotu modulu na stránke
<a name="line239"></a>   * @param  [type] $page_id   [description]
<a name="line240"></a>   * @param  [type] $order     [description]
<a name="line241"></a>   * @param  [type] $module_id [description]
<a name="line242"></a>   * @return [type]            [description]
<a name="line243"></a>   */
<a name="line244"></a>  public function getNewOrderValue($page_id, $order, $module_id){
<a name="line245"></a>    //$order = $this->containerData["order"];
<a name="line246"></a>    //$page_id = $this->containerData["page_id"];
<a name="line247"></a>    
<a name="line248"></a>    //ak je prvy
<a name="line249"></a>    $actual = Module_m::getOrderValue($page_id, $order, $module_id);
<a name="line250"></a>    if($order==1){ 
<a name="line251"></a>      return $actual - 1; 
<a name="line252"></a>    }
<a name="line253"></a>    // ak je posledny
<a name="line254"></a>    if($order == 0) { 
<a name="line255"></a>      $cnt = Module_m::count("page_id", $page_id);
<a name="line256"></a>      if($module_id > 0) $cnt--;
<a name="line257"></a>      return Module_m::getOrderValue($page_id, $cnt, $module_id)+1;
<a name="line258"></a>    }
<a name="line259"></a>    
<a name="line260"></a>    //ak neexistuje
<a name="line261"></a>    if($actual == null){ 
<a name="line262"></a>      return null; 
<a name="line263"></a>    }
<a name="line264"></a>
<a name="line265"></a>    $prev = Module_m::getOrderValue($page_id, $order-1, $module_id);
<a name="line266"></a>    $new = ($actual + $prev) / 2;
<a name="line267"></a>    return $new;
<a name="line268"></a>  }
<a name="line269"></a>  public function printAlert($type="primary", $title, $message){
<a name="line270"></a>    echo '<div class="alert alert-'.$type.'" role="alert"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>'.$title.' </strong> '.$message.'</div>';
<a name="line271"></a>  }
<a name="line272"></a>}
<a name="line273"></a>?></pre>
<div class="header">
<h1>RObo cosi header</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../overview-files.html">Files</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../todo-list.html">Todo</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../source\_controllers\module.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>