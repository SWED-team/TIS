<!doctype html>

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2.0.5 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Tue, 26 Jan 2016 23:51:12 +0000">

<link rel="stylesheet" type="text/css" href="../stylesheet.css">
<link rel="start" href="../overview-summary.html">

<title>filemanager\uploader\index.php (SWEDTeamTitle)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>RObo cosi header</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../overview-files.html">Files</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../todo-list.html">Todo</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../source\filemanager\uploader\index.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>filemanager\uploader\index.php</h1>
<hr>

<a name="line1"></a><pre><?php
<a name="line2"></a>
<a name="line3"></a>$config = include '../config/config.php';
<a name="line4"></a>//TODO switch to array
<a name="line5"></a>extract($config, EXTR_OVERWRITE);
<a name="line6"></a>
<a name="line7"></a>if ( ! $java_upload)
<a name="line8"></a>{
<a name="line9"></a>	die('forbidden');
<a name="line10"></a>}
<a name="line11"></a>if ($_SESSION['RF']["verify"] != "RESPONSIVEfilemanager")
<a name="line12"></a>{
<a name="line13"></a>	die('forbidden');
<a name="line14"></a>}
<a name="line15"></a>
<a name="line16"></a>//Let's load the 'interesting' stuff ...  ;-)
<a name="line17"></a>include 'jupload.php';
<a name="line18"></a>include '../include/utils.php';
<a name="line19"></a>
<a name="line20"></a>$path = $current_path . $_GET['path'];
<a name="line21"></a>$cycle = true;
<a name="line22"></a>$max_cycles = 50;
<a name="line23"></a>$i = 0;
<a name="line24"></a>while ($cycle && $i < $max_cycles)
<a name="line25"></a>{
<a name="line26"></a>	$i++;
<a name="line27"></a>	if ($path == $current_path)
<a name="line28"></a>	{
<a name="line29"></a>		$cycle = false;
<a name="line30"></a>	}
<a name="line31"></a>
<a name="line32"></a>	if (file_exists($path . "config.php"))
<a name="line33"></a>	{
<a name="line34"></a>		require_once $path . "config.php";
<a name="line35"></a>		$cycle = false;
<a name="line36"></a>	}
<a name="line37"></a>	$path = fix_dirname($path) . "/";
<a name="line38"></a>}
<a name="line39"></a>
<a name="line40"></a>$path = "../" . $current_path . $_GET['path'];
<a name="line41"></a>
<a name="line42"></a>if (strpos($_GET['path'], '../') !== false || strpos($_GET['path'], './') !== false || strpos($_GET['path'], '/') === 0)
<a name="line43"></a>{
<a name="line44"></a>	die ('path error');
<a name="line45"></a>}
<a name="line46"></a>
<a name="line47"></a>$path = str_replace(' ', '~', $path);
<a name="line48"></a>////////////////////////////////////////////////////////////////////////////////////////////////////////
<a name="line49"></a>///////////////   The user callback function, that can be called after upload   ////////////////////////
<a name="line50"></a>////////////////////////////////////////////////////////////////////////////////////////////////////////
<a name="line51"></a>/**
<a name="line52"></a> * This function will be called, once all files are uploaded, with the list of uploaded files as an argument.
<a name="line53"></a> *
<a name="line54"></a> * Condition to have this function called:
<a name="line55"></a> * - Have the applet parameter afterUploadURL unset in this file. This makes the applet use its default behavior, that
<a name="line56"></a> * is: afterUploadURL is the current web page, with the ?afterupload=1 parameter added.
<a name="line57"></a> * - Have the class parameter callbackAfterUploadManagement set to 'handle_uploaded_files', name of this callback. You
<a name="line58"></a> * can use any name you want, but the function must accept one unique parameter: the array that contains the file
<a name="line59"></a> * descriptions.
<a name="line60"></a> *
<a name="line61"></a> * @param $juploadPhpSupportClass The instance of the JUpload PHP class.
<a name="line62"></a> * @param $file                   The array wich contains info about all uploaded files.
<a name="line63"></a> */
<a name="line64"></a>function handle_uploaded_files($juploadPhpSupportClass, $files)
<a name="line65"></a>{
<a name="line66"></a>	return
<a name="line67"></a>		"<P>We are in the 'handle_uploaded_files' callback function, in the index.php script. To avoid double coding, we "
<a name="line68"></a>		. "just call the default behavior of the JUpload PHP class. Just replace this by your code...</P>"
<a name="line69"></a>		. $juploadPhpSupportClass->defaultAfterUploadManagement();;
<a name="line70"></a>
<a name="line71"></a>}
<a name="line72"></a>
<a name="line73"></a>////////////////////////////////////////////////////////////////////////////////////////////////////////
<a name="line74"></a>
<a name="line75"></a>
<a name="line76"></a>//First: the applet parameters
<a name="line77"></a>//
<a name="line78"></a>// Default value should work nice on most configuration. In this sample, we use some specific parameters, to show
<a name="line79"></a>// how to use this array.
<a name="line80"></a>// See comment for the parameters used on this demo page.
<a name="line81"></a>//
<a name="line82"></a>// You can use all applet parameters in this array.
<a name="line83"></a>// see all details http://jupload.sourceforge.net/howto-customization.html
<a name="line84"></a>//
<a name="line85"></a>$appletParameters = array(
<a name="line86"></a>	//Default value is ... maximum size for a file on the current FS. 2G is problably too much already.
<a name="line87"></a>	'maxFileSize'           => $JAVAMaxSizeUpload . 'G',
<a name="line88"></a>	//
<a name="line89"></a>	//In the sourceforge project structure, the applet jar file is one folder below. Default
<a name="line90"></a>	//configuration is ok, if wjhk.jupload.jar is in the same folder as the script containing this call.
<a name="line91"></a>	'archive'               => 'wjhk.jupload.jar',
<a name="line92"></a>	'showLogWindow'         => 'false',
<a name="line93"></a>	'width'                 => '100%',
<a name="line94"></a>	'height'                => '358px',
<a name="line95"></a>	'name'                  => 'No limit Uploader',
<a name="line96"></a>	'allowedFileExtensions' => implode('/', $ext),
<a name="line97"></a>	//To manage, other jar files, like the ftp jar files if postURL is an FTP URL:
<a name="line98"></a>	//'archive' => 'wjhk.jupload.jar,jakarta-commons-oro.jar,jakarta-commons-net.jar',
<a name="line99"></a>	//
<a name="line100"></a>	//Default afterUploadURL displays the list of uploaded files above the applet (in the <!--JUPLOAD_FILES--> markers, see below)
<a name="line101"></a>	//You can use any page you want, to manage the uploaded files. Here is a sample, that also only shows the list of files.
<a name="line102"></a>	'afterUploadURL'        => 'success.php?path=' . $_GET['path'],
<a name="line103"></a>	//
<a name="line104"></a>	//This demo expects the md5sum to be sent by the applet. But the parameter is not mandatory
<a name="line105"></a>	//This value should be set to false (or the line commented), for big files, as md5 calculation
<a name="line106"></a>	//may be long  (Note this must be string and *not* boolean true/false)
<a name="line107"></a>	'sendMD5Sum'            => 'false',
<a name="line108"></a>	//
<a name="line109"></a>	'debugLevel'            => 0 // 100 disables redirect after upload, so we keep it below. This still gives a lot of information, in case of problem.
<a name="line110"></a>);
<a name="line111"></a>
<a name="line112"></a>// for htaccess protected folders
<a name="line113"></a>if ((isset($_SERVER['PHP_AUTH_USER']) && $_SERVER['PHP_AUTH_USER'] != '') && $_SERVER['PHP_AUTH_USER'] != '' && $_SERVER['PHP_AUTH_USER'] != '')
<a name="line114"></a>{
<a name="line115"></a>	$appletParameters['specificHeaders'] = 'Authorization: Basic ' . base64_encode($_SERVER['PHP_AUTH_USER'] . ":" . $_SERVER['PHP_AUTH_PW']);
<a name="line116"></a>}
<a name="line117"></a>
<a name="line118"></a>//
<a name="line119"></a>//Then: the jupload PHP class parameters
<a name="line120"></a>$classParameters = array(
<a name="line121"></a>	//Files won't be stored on the server. Useful for first tests of the applet behavior ... and sourceforge demo site !
<a name="line122"></a>	'demo_mode'     => false,
<a name="line123"></a>	//
<a name="line124"></a>	//Allow creation of subdirectories, when uploading several folders/files (drag and drop a folder on the applet to use it).
<a name="line125"></a>	'allow_subdirs' => true,
<a name="line126"></a>	//
<a name="line127"></a>	// The callbackAfterUploadManagement function will be called, once all files are uploaded, with the list
<a name="line128"></a>	//of uploaded files as an argument. See the above sample, and change it according to your needs.
<a name="line129"></a>	//'callbackAfterUploadManagement' => 'handle_uploaded_files',
<a name="line130"></a>	//
<a name="line131"></a>	//I work on windows. The default configuration is /var/tmp/jupload_test
<a name="line132"></a>	'destdir'       => $path  //Where to store the files on the web
<a name="line133"></a>	//'errormail' => 'me@my.domain.org',
<a name="line134"></a>);
<a name="line135"></a>if ( ! empty($convert_spaces))
<a name="line136"></a>{
<a name="line137"></a>	$classParameters['convert_spaces'] = true;
<a name="line138"></a>}
<a name="line139"></a>
<a name="line140"></a>////////////////////////////////////////////////////////////////////////////////////////////////////////
<a name="line141"></a>// Instantiate and initialize JUpload : integration of the applet in your web site.
<a name="line142"></a>$juploadPhpSupportClass = new JUpload($appletParameters, $classParameters);
<a name="line143"></a>////////////////////////////////////////////////////////////////////////////////////////////////////////
<a name="line144"></a>
<a name="line145"></a>
<a name="line146"></a>//Then, a simple HTML page, for the demo
<a name="line147"></a>//
<a name="line148"></a>// "<!--JUPLOAD_FILES-->" is the tag where the list of uploaded files will be written.
<a name="line149"></a>// "<!--JUPLOAD_APPLET-->" is the place where the applet will be integrated, in the web page.
<a name="line150"></a>?>
<a name="line151"></a><html>
<a name="line152"></a><head>
<a name="line153"></a>	<!--JUPLOAD_JSCRIPT-->
<a name="line154"></a>	<title>JUpload RESPONSIVE filemanager</title>
<a name="line155"></a>	<style>
<a name="line156"></a>		body {
<a name="line157"></a>			padding: 0px;
<a name="line158"></a>			margin: 0px;
<a name="line159"></a>		}
<a name="line160"></a>	</style>
<a name="line161"></a></head>
<a name="line162"></a><body>
<a name="line163"></a><div align="center"><!--JUPLOAD_FILES--></div>
<a name="line164"></a><div align="center"><!--JUPLOAD_APPLET--></div>
<a name="line165"></a></body>
<a name="line166"></a></html></pre>
<div class="header">
<h1>RObo cosi header</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../overview-files.html">Files</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../todo-list.html">Todo</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../source\filemanager\uploader\index.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>